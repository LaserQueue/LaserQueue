function ensureNumberStringLength(t,e){return"0".repeat(e-String(t).length)+String(t)}function logText(t){var e=new Date,o=ensureNumberStringLength(e.getDate(),2),n=months[e.getMonth()],a=e.getFullYear(),i=ensureNumberStringLength(e.getHours(),2),r=ensureNumberStringLength(e.getMinutes(),2),s=ensureNumberStringLength(e.getSeconds(),2),l="[{0}/{1}/{2} {3}:{4}:{5}] ".format(o,n,a,i,r,s);if(devLog){for(var c=t.split("\n"),d=c.length-1;d>0;d--)$(".log-pre").prepend('<span class="log-time">'+" ".repeat(23)+"</span> "+c[d]+"\n");$(".log-pre").prepend('<span class="log-time"> '+l+"</span>"+c[0]+"\n")}else window.console.log(l+t)}function populateActions(){logText("Populating actions"),$(".cutting-table-template tr").each(function(t,e){$(e).attr("data-uuid",allCuts[t].uuid),$(e).attr("data-pos",t),$(e).unbind("click")}),isTouchDevice()===!1&&$('[data-toggle="tooltip"]').tooltip(),$(".remove-job").click(function(t){googleAnalytics("send","event","action","click","remove job"),logText("removing item "+$($(this).parents()[1]).attr("data-uuid")),socketSend({action:"remove",args:[$($(this).parents()[1]).attr("data-uuid")]})}),$(".remove-job").popConfirm({content:"Remove this job?",placement:"bottom"}),$(".lower-priority").click(function(){googleAnalytics("send","event","action","click","pass job"),logText("passing item "+$($(this).parents()[1]).attr("data-uuid")),socketSend({action:"pass",args:[$($(this).parents()[1]).attr("data-uuid")]})}),$(".decrement-job").click(function(){googleAnalytics("send","event","action","click","decrement job"),logText("removing item "+$($(this).parents()[1]).attr("data-uuid")),socketSend({action:"decrement",args:[$($(this).parents()[1]).attr("data-uuid")]})}),$(".increment-job").click(function(){googleAnalytics("send","event","action","click","increment job"),logText("passing item "+$($(this).parents()[1]).attr("data-uuid")),socketSend({action:"increment",args:[$($(this).parents()[1]).attr("data-uuid")]})}),(authed||-1==config.authactions.indexOf("relmove"))&&$(".cutting-table-template tr").each(function(t,e){draggable[t]=this,$(this).draggabilly({axis:"y",container:$(".cutting-table-template")}),$(this).on("dragStart",function(){$('[data-toggle="tooltip"]').tooltip("destroy"),$(".cutting-table-template tr:not(.is-dragging) td:nth-child(1) a.glyphicon").addClass("animate-hide")}),$(this).on("dragEnd",function(t,e){$(".cutting-table-template tr:not(.is-dragging) td:nth-child(1) a.glyphicon").removeClass("animate-hide"),$('[data-toggle="tooltip"]').tooltip(),socketSend({action:"relmove",args:[$(this).attr("data-uuid"),parseInt($(this).attr("data-pos"))+parseInt(Math.round($(this).data("draggabilly").position.y/37))]})})})}function modalMessage(t,e){$(".notify-modal-title").html(t),$(".notify-modal-body").html(e),$("#notify-modal").modal()}function resetForm(t){t.find("input:text, input:password, input[type=number], input:file, textarea").val(""),t.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),".new-cut-form"==$(t).selector&&t.find(".selected").prop("selected",!0)}function socketSend(t){"undefined"!=typeof SID&&1==socket.readyState?(t.sid=SID,socket.send(JSON.stringify(t))):("undefined"!=typeof SID&&logText("socketSend() has been called, but SID is undefined."),1!=socket.readyState&&logText("socketSend() has been called, but socket.readyState is not 1. The socket is probably not connected yet."))}function changeAttr(t,e,o){"string"==typeof t?socketSend({action:"attr",args:[t,e,o]}):"number"==typeof t?changeAttr(allCuts[t].uuid,e,o):"object"==typeof t?changeAttr($(t).attr("data-uuid"),e,o):logText("changeAttr() called with invalid taskid type")}function rickRoll(){easterEggs?(modalMessage("Never gonna give you up",'<iframe width="420" height="315" src="http://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&disablekb=1&controls=0&loop=1&showinfo=0&iv_load_policy=3" frameborder="0" allowfullscreen></iframe>'),$("html").addClass("lol")):logText("This is a serious establishment, son. I'm dissapointed in you.")}function isTouchDevice(){return!0===("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}function googleAnalytics(t,e,o,n,a,i,r){"string"!=typeof config.google_analytics_key&&""!==config.google_analytics_key&&ga(t,e,o,n,a,i,r)}function socketSetup(){for(;"undefined"==host;);socket=new WebSocket(host),socket.onopen=function(){logText("WebSockets connection opened successfully"),$("#notify-modal").modal("hide"),socketSend({action:"null"}),setInterval(function(){socket.readyState!=socket.CONNECTING&&socketSend({action:"null"})},refreshRate)},socket.onmessage=function(t){jsonData=JSON.parse(t.data),JSON.stringify(jsonData)!==JSON.stringify(oldJsonData)?(oldJsonData=$.extend({},jsonData),logText("new JSON received: "+JSON.stringify(jsonData)),"display"==jsonData.action&&(allCuts=[],config.admin_mode_enabled&&(jsonData.auths.indexOf(SID.substring(0,18))<0&&authed?onDeauth():jsonData.auths.indexOf(SID.substring(0,18))>=0&&!authed?onAuth():jsonData.deauths.indexOf(SID.substring(0,18))>=0&&!authed&&onFailedauth()),$(jsonData.queue).each(function(t,e){$(e).each(function(t,e){displayEl=$.extend({},e),displayEl.material=materials[e.material],displayEl.priority=priorities[e.priority];var o=e.esttime,n=Math.floor(o/60);o-=60*n;var a=Math.floor(o);o-=a;var i=+(60*o).toFixed(2),r=String(n?n+"h":"")+(a&&n?" ":"");r+=String(a?a+"m":"")+(i&&a?" ":""),r+=String(i?i+"s":""),displayEl.esttime=r,allCuts=allCuts.concat(displayEl)})}),$(".cutting-table-template").render(allCuts,renderDirectives),populateActions())):"rickroll"==jsonData.action?rickRoll():"refresh"==jsonData.action&&config.allow_force_refresh&&window.location.reload()},socket.onerror=function(t){modalMessage("Error 4","Could not connect to socket at "+host+'. Maybe the backend is not running? This page will try to reconnect every few seconds. <br><br> <button class="btn btn-default btn-pink btn-retry">Retry</button>'),$(".btn-retry").click(function(){window.location=window.location.origin+"?foo="+Math.floor(11e3*Math.random())})}}function onAuth(){authed=!0,logText("Displaying authed modal."),modalMessage("Success!",'<p class="lead">You\'ve been authorized!</p>'),setTimeout('\n		$("#notify-modal").modal("hide");\n	',1e3),$(".cutting-table-template").render(allCuts,renderDirectives),$(".disabled").prop("disabled",!1),$(".authorize").attr("data-original-title",config.logout),$(".nuvu-logo").attr("src","/img/admin-logo.svg")}function onFailedauth(){modalMessage("Failure",'<p class="lead">Unfortunately, it looks like your password was wrong.</p>'),logText("Password was wrong. Added to deauths. Shame activated. You're bad and you should feel bad."),socketSend({action:"shame"})}function onDeauth(){authed=!1,logText("User has been deauthed."),$(".cutting-table-template").render(allCuts,renderDirectives),$(".disabled").prop("disabled",!0),$(".authorize").attr("data-original-title",config.login),$(".nuvu-logo").attr("src","/img/logo.svg"),-1!=config.authactions.indexOf("relmove")&&$(draggable).draggabilly("disable")}String.prototype.format||(String.prototype.format=function(){var t=arguments;return this.replace(/{(\d+)}/g,function(e,o){return"undefined"!=typeof t[o]?t[o]:e})}),String.prototype.repeat||(String.prototype.repeat=function(t){"use strict";if(null==this)throw new TypeError("can't convert "+this+" to object");var e=""+this;if(t=+t,t!=t&&(t=0),0>t)return e;if(t==1/0)throw new RangeError("repeat count must be less than infinity");if(t=Math.floor(t),0==e.length||0==t)return"";if(e.length*t>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var o="";1==(1&t)&&(o+=e),t>>>=1,0!=t;)e+=e;return o});var getConfigFile,config,host,jsonData,socket,materials,priorities,refreshRate,reconnectRate,easterEggs,SID,buttons,authed=!1,allCuts=[],displayEl={},months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],renderDirectives={priority:{html:function(t){return this.priority+(this.coachmodified?' <span class="glyphicon glyphicon-cog coach-modified" data-toggle="tooltip" data-placement="bottom" title="'+config.modified_hover+'"></span>':"")}},actions:{html:function(t){for(var e="",o=0;o<Object.keys(buttons).length;o++){var n=Object.keys(buttons)[o];(-1==config.authactions.indexOf(n)||authed)&&("pass"==n&&(t.index>=config.pass_depth&&config.pass_depth||authed)||(e+=buttons[n]))}return e}}},draggable=[];SID=uuid.v1(),window.console.log("SID: "+SID),getConfigFile=$.getJSON("/config.json",function(){config=getConfigFile.responseJSON,devLog=config.dev_log,1!=devLog?$("[for=log-checkbox]").remove():console.log("Recommended: use the in-page log. Most info goes there."),logText("Log starts here"),logText("Config file follows: "+JSON.stringify(config,null,2)),host="ws://"+config.host+":"+config.port,materials=config.materials,priorities=config.priorities,refreshRate=config.refreshRate,reconnectRate=config.reconnectRate,easterEggs=config.easter_eggs,""==config.default_material&&$("#cut-material").append('\n			<option disabled selected value="N/A" class="selected">'+config.material_input+"</option>\n		");for(var t in materials){var e=t===config.default_material?"selected":"";$("#cut-material").append("\n			<option "+e+' value="'+t+'" class="'+e+'">'+materials[t]+"</option>\n		")}config.priority_choose&&$("#priority-dropdown").append('\n			<option disabled selected value="-1" class="selected">'+config.priority_input+"</option>\n		");for(var o in priorities){var n=o<config.default_priority&&!config.priority_selection?"disabled ":"",e=o!=config.default_priority||config.priority_choose?"":"selected";$("#priority-dropdown").append("\n			<option "+e+' value="'+String(priorities.length-o-1)+'"  class="'+n+e+'">'+priorities[o]+"</option>\n		")}config.priority_selection||$(".disabled").prop("disabled",!0),$(".cut-human-name").attr("placeholder",config.name_input),$(".cut-time-estimate").attr("placeholder",config.time_input),$(".cut-human-name").attr("title",config.name_hover),$(".cut-time-estimate").attr("title",config.time_hover),$(".cut-material").attr("title",config.material_hover),$(".priority-dropdown").attr("title",config.priority_hover),$(".action-header").text(config.action_header),$(".name-header").text(config.name_header),$(".material-header").text(config.material_header),$(".time-header").text(config.time_header),$(".priority-header").text(config.priority_header),buttons={remove:'\n<a role="button" tabindex="0" class="glyphicon glyphicon-remove remove-job" data-toggle="tooltip" data-placement="right" title="'+config.remove_hover+'"></a>',increment:'\n<a role="button" tabindex="0" class="glyphicon glyphicon-chevron-up increment-job" data-toggle="tooltip" data-placement="right" title="'+config.incr_hover+'"></a>',decrement:'\n<a role="button" tabindex="0" class="glyphicon glyphicon-chevron-down decrement-job" data-toggle="tooltip" data-placement="right" title="'+config.decr_hover+'"></a>',pass:'\n<a role="button" tabindex="0" class="glyphicon glyphicon-triangle-bottom lower-priority" data-toggle="tooltip" data-placement="right" title="'+config.pass_hover+'"></a>',relmove:'\n<a role="button" tabindex="0" class="glyphicon glyphicon-menu-hamburger move-job" data-toggle="tooltip" data-placement="right" title="'+config.drag_hover+'"></a>'},config.admin_mode_enabled&&($(".authorize").click(function(){authed?(socketSend({action:"deauth"}),$(".authorize").tooltip("hide")):(modalMessage("Authenticate",'\n					<form class="login-form">\n						<div class="form-group">\n							<label for="password">Password</label>\n							<input type="password" class="form-control coach-password" id="password" placeholder="Password">\n						</div>\n						<button type="submit" class="btn btn-default">Sign in</button>\n					</form>\n				'),$(".authorize").tooltip("hide"),setTimeout('\n					$(".coach-password").focus();\n				',500),$(".login-form").submit(function(t){t.preventDefault(),""!=$("#password").val()&&(logText("Password entered. Attempting auth."),socketSend({action:"auth",args:[sha1($("#password").val())]}))}))}),$(".authorize").attr("data-original-title",config.login)),""==config.google_analytics_key?logText("Google Analytics tracking is not enabled."):(logText("Google Analytics tracking is enabled with key "+config.google_analytics_key),function(t,e,o,n,a,i,r){t.GoogleAnalyticsObject=a,t[a]=t[a]||function(){(t[a].q=t[a].q||[]).push(arguments)},t[a].l=1*new Date,i=e.createElement(o),r=e.getElementsByTagName(o)[0],i.async=1,i.src=n,r.parentNode.insertBefore(i,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),googleAnalytics("create",config.google_analytics_key,{cookieDomain:"none"}),googleAnalytics("send","pageview")),logText("LaserCutter software is up. Attempting connection to WebSockets host "+host),socketSetup(),setInterval(function(){"undefined"==typeof reconnectRate||"undefined"!=typeof socket&&socket.readyState!=socket.CLOSED||(logText("Attempting connection to WebSockets host",host),socketSetup())},reconnectRate)});var oldJsonData="uninitialized",jsonData;$(".notify-modal-title").html("Notification"),$.ajax({url:"/infotext.md",type:"GET"}).done(function(t){$(".credits-footer").before(marked(t))}).fail(function(){console.log("Failed to get infotext.md")}),isTouchDevice()||$(".cut-human-name").focus(),$(document).ready(function(){$(".btn-submit").click(function(t){t.preventDefault(),logText("submit button clicked");var e=$(".cut-time-estimate").val().match(/\d*(\.\d+)?/);socketSend({action:"add",args:[$(".cut-human-name").val(),+$(".priority-dropdown").val(),+e[0],$(".cut-material").val()]}),resetForm($(".new-cut-form")),$(".cut-human-name").focus()});var t=new Konami;t.code=function(){rickRoll()},t.load()});
//# sourceMappingURL=scripts.min.js.map