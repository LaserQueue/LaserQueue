function logText(e){if(devLog){var t=new Date,o=t.getHours(),i=t.getMinutes(),n=t.getSeconds(),s=t.getMilliseconds(),a=10>o?"0":"",r=10>i?"0":"",l=10>n?"0":"",c=10>s?"00":100>s?"0":"";$(".log-pre").prepend("<span class='log-time'> ["+a+o+":"+r+i+":"+l+n+"."+c+s+"]:</span> "+e+"\n")}}function populateActions(){$(".cutting-table-template tr td:nth-child(1)").each(function(e,t){$(t).children("i").each(function(t,o){$(o).attr("data-uuid",allCuts[e].uuid),$(o).unbind("click")})}),$('[data-toggle="tooltip"]').tooltip(),$(".remove-job").click(function(){logText("removing item "+$(this).attr("data-uuid")),socket.send(JSON.stringify({action:"uremove",args:[$(this).attr("data-uuid")],sid:SID}))}),$(".lower-priority").click(function(){logText("passing item "+$(this).attr("data-uuid")),socket.send(JSON.stringify({action:"upass",args:[$(this).attr("data-uuid")],sid:SID}))})}function modalMessage(e,t){$(".notify-modal-title").html(e),$(".notify-modal-body").html(t),$("#notify-modal").modal()}function resetForm(e){e.find("input:text, input:password, input[type=number], input:file, textarea").val(""),e.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),".new-cut-form"==$(e).selector}function rickRoll(){easterEggs?(modalMessage("Never gonna give you up",'<iframe width="420" height="315" src="http://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&disablekb=1&controls=0&loop=1&showinfo=0&iv_load_policy=3" frameborder="0" allowfullscreen></iframe>'),$("html").addClass("lol")):logText("This is a serious establishment, son. I'm dissapointed in you.")}function socketSetup(){for(;"undefined"==host;);socket=new WebSocket(host),socket.onopen=function(){logText("WebSockets connection opened successfully \n"),$("#notify-modal").modal("hide"),socket.send(JSON.stringify({action:"null"})),setInterval(function(){socket.readyState!=socket.CONNECTING&&socket.send(JSON.stringify({action:"null",sid:SID}))},refreshRate)},socket.onmessage=function(e){jsonData=JSON.parse(e.data),JSON.stringify(jsonData)!==JSON.stringify(oldJsonData)?"display"==jsonData.action&&(oldJsonData=$.extend({},jsonData),logText("new JSON received: "+JSON.stringify(jsonData)),allCuts=[],$(jsonData.queue).each(function(e,t){$(t).each(function(e,t){displayEl=$.extend({},t),displayEl.material=materials[t.material],displayEl.priority=priorities[t.priority],displayEl.esttime=t.esttime+(1==t.esttime?" minute":" minutes"),allCuts=allCuts.concat(displayEl)})}),$(".cutting-table-template").render(allCuts,renderDirectives),populateActions()):"rickroll"==jsonData.action&&rickRoll()},socket.onerror=function(e){modalMessage("Error 4","Could not connect to socket at "+host+". Maybe the backend is not running? This page will try to reconnect every few seconds. <br><br> <button class='btn btn-default btn-pink btn-retry'>Retry</button>"),$(".btn-retry").click(function(){window.location=window.location.origin+"?foo="+Math.floor(11e3*Math.random())})}}var getConfigFile,config,host,jsonData,socket,materials,priorities,refreshRate,reconnectRate,easterEggs,SID,authed=!1,allCuts=[],displayEl={},renderDirectives={priority:{html:function(e){return this.priority+(this.coachmodified?' <span class="glyphicon glyphicon-cog coach-modified" data-toggle="tooltip" data-placement="bottom" title="'+getConfigFile.responseJSON.modified_hover+'"></span>':"")}}};SID=uuid.v1(),window.console.log("I have SID "+SID),getConfigFile=$.getJSON("/config.json",function(){config=getConfigFile.responseJSON,devLog=getConfigFile.responseJSON.dev_log,1!=devLog&&$("[for=log-checkbox]").slideUp(),logText("Config file follows:"+JSON.stringify(getConfigFile.responseJSON,null,2)),host="ws://"+getConfigFile.responseJSON.host+":"+getConfigFile.responseJSON.port,materials=getConfigFile.responseJSON.materials,priorities=getConfigFile.responseJSON.priorities,refreshRate=getConfigFile.responseJSON.refreshRate,reconnectRate=getConfigFile.responseJSON.reconnectRate,easterEggs=getConfigFile.responseJSON.easter_eggs;for(var e in materials)$("#cut-material").append("\n			<option "+(e===config.default_material?"selected":"")+' value="'+e+'">'+materials[e]+"</option>\n		");for(var t in priorities)$("#priority-dropdown").append("\n			<option "+(t==config.default_priority?"selected":"")+' value="'+String(priorities.length-t-1)+'">'+priorities[t]+"</option>\n		")}),window.console.log("This silly browser log is generally not used. Click the console button at the bottom of the page instead! If there are errors here, please raise an issue."),setInterval(function(){"undefined"==typeof reconnectRate||"undefined"!=typeof socket&&socket.readyState!=socket.CLOSED||(logText("LaserCutter software is up. Attempting connection to WebSockets host",host),socketSetup())},reconnectRate);var oldJsonData="uninitialized",jsonData;$(".notify-modal-title").html("Notification"),$(".nuvu-logo").click(function(){modalMessage("Authenticate",'\n		<form class="login-form">\n			<div class="form-group">\n				<label for="password">Password</label>\n				<input type="password" class="form-control" id="password" placeholder="Password">\n			</div>\n			<button type="submit" class="btn btn-default">Sign in</button>\n		</form>\n	'),$(".login-form").submit(function(e){e.preventDefault(),""!=$("#password").val()&&(logText('Password entered. Attempting auth and switching to "Logging in" modal.'),socket.send(JSON.stringify({action:"auth",args:[sha1($("#password").val())],sid:SID})),modalMessage("Logging in",'\n				<div class="progress">\n	    			<div class="progress-bar progress-bar-striped progress-bar-success active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n	    				<span>Logging in. This should take just a moment...</span>\n	    			</div>\n				</div>\n			'))})}),$.ajax({url:"/infotext.md",type:"GET"}).done(function(e){$(".credits-footer").before(marked(e))}).fail(function(){console.log("Failed to get infotext.md")}),$(document).ready(function(){$(".btn-submit").click(function(e){e.preventDefault(),logText("submit button clicked"),socket.send(JSON.stringify({action:"add",args:[$(".cut-human-name").val(),+$(".priority-dropdown").val(),+$(".cut-time-estimate").val(),$(".cut-material").val()],sid:SID})),resetForm($(".new-cut-form"))});var e=new Konami;e.code=function(){rickRoll()},e.load()});