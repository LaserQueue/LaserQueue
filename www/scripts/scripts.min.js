function auth(){authed=!0,logText("Displaying authed modal."),modalMessage("Success!",'<p class="lead">You\'ve been authorized!</p>'),setTimeout("\n		$('#notify-modal').modal('hide');\n	",2e3),$(".cutting-table-template").render(allCuts,renderDirectives),$(".disabled").prop("disabled",!1)}function failedauth(){modalMessage("Failure",'<p class="lead">Unfortunately, it looks like your password was wrong.</p>'),logText("Password was wrong. Added to deauths. Shame activated. You're bad and you should feel bad."),socketSend({action:"shame"})}function deauth(){authed=!1,logText("User has been deauthed."),$(".disabled").prop("disabled",!0)}function logText(t){if(devLog){var e=new Date,o=e.getHours(),i=e.getMinutes(),n=e.getSeconds(),a=e.getMilliseconds(),s=10>o?"0":"",l=10>i?"0":"",r=10>n?"0":"",c=10>a?"00":100>a?"0":"";$(".log-pre").prepend("<span class='log-time'> ["+s+o+":"+l+i+":"+r+n+"."+c+a+"]:</span> "+t+"\n")}}function populateActions(){logText("Populating actions"),$(".cutting-table-template tr td:nth-child(1)").each(function(t,e){$(e).children("i").each(function(e,o){$(o).attr("data-uuid",allCuts[t].uuid),$(o).unbind("click")})}),$('[data-toggle="tooltip"]').tooltip(),$(".remove-job").click(function(){logText("removing item "+$(this).attr("data-uuid")),socketSend({action:"uremove",args:[$(this).attr("data-uuid")]})}),$(".lower-priority").click(function(){logText("passing item "+$(this).attr("data-uuid")),socketSend({action:"upass",args:[$(this).attr("data-uuid")]})}),$(".decrement-job").click(function(){logText("removing item "+$(this).attr("data-uuid")),socketSend({action:"udecrement",args:[$(this).attr("data-uuid")]})}),$(".increment-job").click(function(){logText("passing item "+$(this).attr("data-uuid")),socketSend({action:"uincrement",args:[$(this).attr("data-uuid")]})})}function modalMessage(t,e){$(".notify-modal-title").html(t),$(".notify-modal-body").html(e),$("#notify-modal").modal()}function resetForm(t){t.find("input:text, input:password, input[type=number], input:file, textarea").val(""),t.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),".new-cut-form"==$(t).selector&&t.find(".selected").prop("selected",!0)}function socketSend(t){t.sid=SID,socket.send(JSON.stringify(t))}function rickRoll(){easterEggs?(modalMessage("Never gonna give you up",'<iframe width="420" height="315" src="http://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&disablekb=1&controls=0&loop=1&showinfo=0&iv_load_policy=3" frameborder="0" allowfullscreen></iframe>'),$("html").addClass("lol")):logText("This is a serious establishment, son. I'm dissapointed in you.")}function socketSetup(){for(;"undefined"==host;);socket=new WebSocket(host),socket.onopen=function(){logText("WebSockets connection opened successfully \n"),$("#notify-modal").modal("hide"),socketSend({action:"null"}),setInterval(function(){socket.readyState!=socket.CONNECTING&&socketSend({action:"null"})},refreshRate)},socket.onmessage=function(t){jsonData=JSON.parse(t.data),JSON.stringify(jsonData)!==JSON.stringify(oldJsonData)?(oldJsonData=$.extend({},jsonData),logText("new JSON received: "+JSON.stringify(jsonData)),"display"==jsonData.action&&(allCuts=[],config.admin_mode_enabled&&(jsonData.auths.indexOf(SID.substring(0,18))<0&&authed?deauth():jsonData.auths.indexOf(SID.substring(0,18))>=0&&!authed?auth():jsonData.deauths.indexOf(SID.substring(0,18))>=0&&!authed&&failedauth()),$(jsonData.queue).each(function(t,e){$(e).each(function(t,e){displayEl=$.extend({},e),displayEl.material=materials[e.material],displayEl.priority=priorities[e.priority],displayEl.esttime=e.esttime+(1==e.esttime?" minute":" minutes"),allCuts=allCuts.concat(displayEl)})}),$(".cutting-table-template").render(allCuts,renderDirectives),populateActions())):"rickroll"==jsonData.action?rickRoll():"refresh"==jsonData.action&&config.allow_force_refresh&&window.location.reload()},socket.onerror=function(t){modalMessage("Error 4","Could not connect to socket at "+host+". Maybe the backend is not running? This page will try to reconnect every few seconds. <br><br> <button class='btn btn-default btn-pink btn-retry'>Retry</button>"),$(".btn-retry").click(function(){window.location=window.location.origin+"?foo="+Math.floor(11e3*Math.random())})}}var getConfigFile,config,host,jsonData,socket,materials,priorities,refreshRate,reconnectRate,easterEggs,SID,authed=!1,allCuts=[],displayEl={},renderDirectives={priority:{html:function(t){return this.priority+(this.coachmodified?' <span class="glyphicon glyphicon-cog coach-modified" data-toggle="tooltip" data-placement="bottom" title="'+getConfigFile.responseJSON.modified_hover+'"></span>':"")}},actions:{html:function(t){return authed?'\n				<i class="glyphicon glyphicon-remove remove-job" data-toggle="tooltip" data-placement="right" title="Cancel this job"></i>\n				<i class="glyphicon glyphicon-chevron-up increment-job" data-toggle="tooltip" data-placement="right" title="Increment this job"></i> \n				<i class="glyphicon glyphicon-chevron-down decrement-job" data-toggle="tooltip" data-placement="right" title="Decrement this job"></i>':'\n				<i class="glyphicon glyphicon-remove remove-job" data-toggle="tooltip" data-placement="right" title="Cancel this job"></i>\n				<i class="glyphicon glyphicon-triangle-bottom lower-priority" data-toggle="tooltip" data-placement="right" title="Move job down"></i>'}}};SID=uuid.v1(),window.console.log("I have SID "+SID),getConfigFile=$.getJSON("/config.json",function(){config=getConfigFile.responseJSON,devLog=config.dev_log,1!=devLog&&$("[for=log-checkbox]").slideUp(),logText("Config file follows:"+JSON.stringify(getConfigFile.responseJSON,null,2)),host="ws://"+config.host+":"+config.port,materials=config.materials,priorities=config.priorities,refreshRate=config.refreshRate,reconnectRate=config.reconnectRate,easterEggs=config.easter_eggs;for(var t in materials){var e=t===config.default_material?"selected":"";$("#cut-material").append("\n			<option "+e+' value="'+t+'" class="'+e+'">'+materials[t]+"</option>\n		")}for(var o in priorities){var i=o<config.default_priority&&!config.priority_selection?"disabled ":"",e=o==config.default_priority?"selected":"";$("#priority-dropdown").append("\n			<option "+e+' value="'+String(priorities.length-o-1)+'"  class="'+i+e+'">'+priorities[o]+"</option>\n		")}config.priority_selection||$(".disabled").prop("disabled",!0),""==config.google_analytics_key?logText("Google Analytics tracking is not enabled."):(logText("Google Analytics tracking is enabled with key "+config.google_analytics_key),function(t,e,o,i,n,a,s){t.GoogleAnalyticsObject=n,t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},t[n].l=1*new Date,a=e.createElement(o),s=e.getElementsByTagName(o)[0],a.async=1,a.src=i,s.parentNode.insertBefore(a,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",config.google_analytics_key,{cookieDomain:"none"}),ga("send","pageview"))}),window.console.log("This silly browser log is generally not used. Click the console button at the bottom of the page instead! If there are errors here, please raise an issue."),setInterval(function(){"undefined"==typeof reconnectRate||"undefined"!=typeof socket&&socket.readyState!=socket.CLOSED||(logText("LaserCutter software is up. Attempting connection to WebSockets host",host),socketSetup())},reconnectRate);var oldJsonData="uninitialized",jsonData;$(".notify-modal-title").html("Notification"),$(".authorize").click(function(){authed||(modalMessage("Authenticate",'\n			<form class="login-form">\n				<div class="form-group">\n					<label for="password">Password</label>\n					<input type="password" class="form-control coach-password" id="password" placeholder="Password">\n				</div>\n				<button type="submit" class="btn btn-default">Sign in</button>\n			</form>\n		'),setTimeout("\n			$('.coach-password').focus();\n		",500),$(".login-form").submit(function(t){t.preventDefault(),""!=$("#password").val()&&(logText('Password entered. Attempting auth and switching to "Logging in" modal.'),socketSend({action:"auth",args:[sha1($("#password").val())]}))}))}),$.ajax({url:"/infotext.md",type:"GET"}).done(function(t){$(".credits-footer").before(marked(t))}).fail(function(){console.log("Failed to get infotext.md")}),$(document).ready(function(){$(".btn-submit").click(function(t){t.preventDefault(),logText("submit button clicked"),socketSend({action:"add",args:[$(".cut-human-name").val(),+$(".priority-dropdown").val(),+$(".cut-time-estimate").val(),$(".cut-material").val()]}),resetForm($(".new-cut-form"))});var t=new Konami;t.code=function(){rickRoll()},t.load()});
//# sourceMappingURL=./scripts.min.js.map