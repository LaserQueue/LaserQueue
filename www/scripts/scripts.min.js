function socketSetup(){for(;"undefined"==host;);socket=new WebSocket(host),socket.onopen=function(){logText("WebSockets connection opened successfully \n"),$("#notify-modal").modal("hide"),socket.send(JSON.stringify({action:"null"})),setInterval(function(){socket.readyState!=socket.CONNECTING&&socket.send(JSON.stringify({action:"null"}))},refreshRate)},socket.onmessage=function(e){jsonData=JSON.parse(e.data),console.log(typeof jsonData.action),logText("Command received: "+jsonData.action),"display"==jsonData.action?JSON.stringify(jsonData)!==JSON.stringify(oldJsonData)&&(oldJsonData=$.extend({},jsonData),logText("new JSON received: "+JSON.stringify(jsonData)),allCuts=[],$(jsonData.queue).each(function(e,t){$(t).each(function(e,t){displayEl=$.extend({},t),displayEl.material=materials[t.material],displayEl.priority=priorities[t.priority],displayEl.esttime=t.esttime+(1==t.esttime?" minute":" minutes"),allCuts=allCuts.concat(displayEl)})}),$(".cutting-table-template").render(allCuts,renderDirectives),populateActions()):"rickroll"==jsonData.action&&rickroll()},socket.onerror=function(e){modalMessage("Error 4","Could not connect to socket at "+host+". Maybe the backend is not running? This page will try to reconnect every few seconds. <br><br> <button class='btn btn-default btn-pink btn-retry'>Retry</button>"),$(".btn-retry").click(function(){window.location=window.location.origin+"?foo="+Math.floor(11e3*Math.random())})}}function logText(e){if(devLog){var t=new Date,o=t.getHours(),n=t.getMinutes(),i=t.getSeconds(),a=t.getMilliseconds(),s=10>o?"0":"",r=10>n?"0":"",l=10>i?"0":"",c=10>a?"00":100>a?"0":"";$(".log-pre").prepend("<span class='log-time'> ["+s+o+":"+r+n+":"+l+i+"."+c+a+"]:</span> "+e+"\n")}}function populateActions(){$(".cutting-table-template tr td:nth-child(1)").each(function(e,t){$(t).children("i").each(function(t,o){$(o).attr("data-uuid",allCuts[e].uuid),$(o).unbind("mousedown")})}),$('[data-toggle="tooltip"]').tooltip(),$(".remove-job").mousedown(function(){logText("removing item "+$(this).attr("data-uuid")),socket.send(JSON.stringify({action:"uremove",args:[$(this).attr("data-uuid")]}))}),$(".lower-priority").mousedown(function(){logText("passing item "+$(this).attr("data-uuid")),socket.send(JSON.stringify({action:"upass",args:[$(this).attr("data-uuid")]}))})}function modalMessage(e,t){$(".notify-modal-title").html(e),$(".notify-modal-body").html(t),$("#notify-modal").modal()}function resetForm(e){e.find("input:text, input:password, input:file, textarea").val(""),e.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),".new-cut-form"==$(e).selector}function rickRoll(){modalMessage("You goofed",'<iframe width="420" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&disablekb=1&controls=0&loop=1&showinfo=0&iv_load_policy=3" frameborder="0" allowfullscreen></iframe>'),$("html").addClass("lol")}var getConfigFile,config,host,jsonData,socket,materials,priorities,refreshRate,reconnectRate,allCuts=[],displayEl={},renderDirectives={priority:{html:function(e){return this.priority+(this.coachmodified?' <span class="glyphicon glyphicon-cog coach-modified" data-toggle="tooltip" data-placement="bottom" title="'+getConfigFile.responseJSON.modified_hover+'"></span>':"")}}};getConfigFile=$.getJSON("/config.json",function(){config=getConfigFile.responseJSON,devLog=getConfigFile.responseJSON.dev_log,1!=devLog&&$("[for=log-checkbox]").slideUp(),logText("Config file follows:"+JSON.stringify(getConfigFile.responseJSON,null,2)),host="ws://"+getConfigFile.responseJSON.host+":"+getConfigFile.responseJSON.port,materials=getConfigFile.responseJSON.materials,priorities=getConfigFile.responseJSON.priorities,refreshRate=getConfigFile.responseJSON.refreshRate,reconnectRate=getConfigFile.responseJSON.reconnectRate;for(var e in materials)$("#cut-material").append("\n			<option "+(e===config.default_material?"selected":"")+' value="'+e+'">'+materials[e]+"</option>\n		");for(var t in priorities)$("#priority-dropdown").append("\n			<option "+(t==config.default_priority?"selected":"")+' value="'+t+'">'+priorities[t]+"</option>\n		")}),window.console.log("This silly browser log is generally not used. Click the console button at the bottom of the page instead! If there are errors here, please raise an issue."),setInterval(function(){"undefined"==typeof reconnectRate||"undefined"!=typeof socket&&socket.readyState!=socket.CLOSED||(logText("LaserCutter software is up. Attempting connection to WebSockets host",host),socketSetup())},reconnectRate);var oldJsonData="uninitialized",jsonData;$(".notify-modal-title").html("Notification"),$(".nuvu-logo").click(function(){modalMessage("Authenticate",'\n		<form class="login-form">\n			<div class="form-group">\n				<label for="password">Password</label>\n				<input type="password" class="form-control" id="password" placeholder="Password">\n			</div>\n			<button type="submit" class="btn btn-default">Sign in</button>\n		</form>\n	'),$(".login-form").submit(function(e){e.preventDefault(),"imacoach"!==$("#password").val()?modalMessage("WHO DO YOU THINK YOU ARE","I understand. You found paradise in America, you had a good trade, you made a good living. The police protected you and there were courts of law. You didn't need a friend like me. But, now you come to me, and you say: \"LaserQueue, give me justice.\" But you don't ask with respect. You don't offer friendship. You don't even think to call me Godfather. Instead, you come into my house on the day my daughter is to be married, you tell me you're a coach, and you LIE TO ME."):coachMode()})}),$(document).ready(function(){$(".btn-submit").click(function(e){e.preventDefault(),logText("submit button clicked"),socket.send('\n			{\n				"action": "add",\n				"args": [\n				"'+$(".cut-human-name").val()+'", '+$(".priority-dropdown").val()+", "+$(".cut-time-estimate").val()+', "'+$(".cut-material").val()+'"\n				]\n			}\n		'),resetForm($(".new-cut-form"))});var e=new Konami;e.code=function(){rickRoll()},e.load()});
//# sourceMappingURL=./scripts.min.js.map