function socketSetup(){for(;"undefined"==host;);socket=new WebSocket(host),socket.onopen=function(){logText("WebSockets connection opened successfully \n"),$("#notify-modal").modal("hide"),socket.send(JSON.stringify({action:"null"})),setInterval(function(){socket.readyState!=socket.CONNECTING&&socket.send(JSON.stringify({action:"null"}))},refreshRate)},socket.onmessage=function(t){jsonData=JSON.parse(JSON.parse(t.data)),JSON.stringify(jsonData)!==JSON.stringify(oldJsonData)&&(oldJsonData=$.extend({},jsonData),logText("new JSON received: "+JSON.stringify(jsonData)),allCuts=[],$(jsonData.queue).each(function(t,e){$(e).each(function(t,e){displayEl=$.extend({},e),displayEl.material=materials[e.material],displayEl.priority=priorities[e.priority],displayEl.esttime=e.esttime+(1==e.esttime?" minute":" minutes"),allCuts=allCuts.concat(displayEl)})}),$(".cutting-table-template").render(allCuts,renderDirectives),populateActions())},socket.onerror=function(t){modalMessage("Error 4","Could not connect to socket at "+host+". Maybe the backend is not running? This page will try to reconnect every few seconds. <br><br> <button class='btn btn-default btn-pink btn-retry'>Retry</button>"),$(".btn-retry").click(function(){window.location=window.location.origin+"?foo="+Math.floor(11e3*Math.random())})}}function logText(t){if(devLog){var e=new Date,o=e.getHours(),n=e.getMinutes(),i=e.getSeconds(),a=e.getMilliseconds(),s=10>o?"0":"",r=10>n?"0":"",l=10>i?"0":"",c=10>a?"00":100>a?"0":"";$(".log-pre").prepend("<span class='log-time'> ["+s+o+":"+r+n+":"+l+i+"."+c+a+"]:</span> "+t+"\n")}}function populateActions(){$(".cutting-table-template tr td:nth-child(1)").each(function(t,e){$(e).children("i").each(function(e,o){$(o).attr("data-uuid",allCuts[t].uuid),$(o).unbind("click")})}),$('[data-toggle="tooltip"]').tooltip(),$(".remove-job").click(function(){logText("removing item "+$(this).attr("data-uuid")),socket.send(JSON.stringify({action:"uremove",args:[$(this).attr("data-uuid")]}))}),$(".lower-priority").click(function(){logText("passing item "+$(this).attr("data-uuid")),socket.send(JSON.stringify({action:"upass",args:[$(this).attr("data-uuid")]}))})}function modalMessage(t,e){$(".notify-modal-title").html(t),$(".notify-modal-body").html(e),$("#notify-modal").modal()}function resetForm(t){t.find("input:text, input:password, input:file, textarea").val(""),t.find("input:radio, input:checkbox").removeAttr("checked").removeAttr("selected"),".new-cut-form"==$(t).selector}var getConfigFile,config,host,jsonData,socket,materials,priorities,refreshRate,reconnectRate,allCuts=[],displayEl={},renderDirectives={priority:{html:function(t){return this.priority+(this.coachmodified?' <span class="glyphicon glyphicon-cog coach-modified" data-toggle="tooltip" data-placement="bottom" title="'+getConfigFile.responseJSON.modified_hover+'"></span>':"")}}};getConfigFile=$.getJSON("/config.json",function(){config=getConfigFile.responseJSON,devLog=getConfigFile.responseJSON.dev_log,1!=devLog&&$("[for=log-checkbox]").slideUp(),logText("Config file follows:"+JSON.stringify(getConfigFile.responseJSON,null,2)),host="ws://"+getConfigFile.responseJSON.host+":"+getConfigFile.responseJSON.port,materials=getConfigFile.responseJSON.materials,priorities=getConfigFile.responseJSON.priorities.reverse(),refreshRate=getConfigFile.responseJSON.refreshRate,reconnectRate=getConfigFile.responseJSON.reconnectRate;for(var t in materials)$("#cut-material").append("\n			<option "+(t===config.default_material?"selected":"")+' value="'+t+'">'+materials[t]+"</option>\n		");for(var e in priorities)$("#priority-dropdown").append("\n			<option "+(e==config.default_priority?"selected":"")+' value="'+e+'">'+priorities[e]+"</option>\n		")}),window.console.log("This silly browser log is generally not used. Click the console button at the bottom of the page instead! If there are errors here, please raise an issue."),setInterval(function(){"undefined"==typeof reconnectRate||"undefined"!=typeof socket&&socket.readyState!=socket.CLOSED||(logText("LaserCutter software is up. Attempting connection to WebSockets host",host),socketSetup())},reconnectRate);var oldJsonData="uninitialized",jsonData;$(".notify-modal-title").html("Notification"),$(document).ready(function(){$(".btn-submit").click(function(t){t.preventDefault(),logText("submit button clicked"),socket.send('\n			{\n				"action": "add",\n				"args": [\n				"'+$(".cut-human-name").val()+'", '+$(".priority-dropdown").val()+", "+$(".cut-time-estimate").val()+', "'+$(".cut-material").val()+'"\n				]\n			}\n		'),resetForm($(".new-cut-form"))})});
//# sourceMappingURL=./scripts.min.js.map